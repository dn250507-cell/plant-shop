<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tra H·ªá Th·ªëng - C√¢y Gi·ªëng Vi·ªát</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 2rem;
            line-height: 1.5;
        }

        .pass {
            color: #4eba6f;
            font-weight: bold;
        }

        .fail {
            color: #ff4757;
            font-weight: bold;
        }

        .info {
            color: #f8b500;
        }

        .box {
            background: #333;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
    </style>
</head>

<body>
    <h1>üõ†Ô∏è C√¥ng C·ª• Ch·∫©n ƒêo√°n H·ªá Th·ªëng</h1>
    <div id="results">ƒêang ch·∫°y ki·ªÉm tra...</div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="js/firebase-config.js"></script>

    <script>
        const results = document.getElementById('results');
        function log(msg, type = '') {
            const div = document.createElement('div');
            div.innerHTML = type ? `[<span class="${type}">${type.toUpperCase()}</span>] ${msg}` : msg;
            results.appendChild(div);
        }

        async function runDiagnostics() {
            results.innerHTML = '';

            // 1. Check Firebase SDK
            if (typeof firebase !== 'undefined') {
                log('Firebase SDK ƒë√£ ƒë∆∞·ª£c t·∫£i', 'pass');
            } else {
                log('Kh√¥ng t√¨m th·∫•y Firebase SDK. Ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.', 'fail');
                return;
            }

            // 2. Check Config
            if (firebase.apps.length > 0) {
                log('Firebase App ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o', 'pass');
            } else {
                log('Ch∆∞a kh·ªüi t·∫°o Firebase Config', 'fail');
                return;
            }

            // 3. Test Firestore Connection
            try {
                const db = firebase.firestore();
                log('ƒêang k·∫øt n·ªëi ƒë·∫øn Database...', 'info');

                // Try simple read
                const testDoc = await db.collection('users').limit(1).get();
                log('K·∫øt n·ªëi Database th√†nh c√¥ng!', 'pass');

                // 4. Check Admin Account
                const adminDoc = await db.collection('users').doc('admin').get();
                if (adminDoc.exists) {
                    const data = adminDoc.data();
                    log(`ƒê√£ t√¨m th·∫•y t√†i kho·∫£n Admin: ${data.username}`, 'pass');
                    log(`M·∫≠t kh·∫©u (ƒë√£ l∆∞u): ${data.password}`, 'info');
                } else {
                    log('Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n Admin!', 'fail');
                    log('ƒê·ªÅ xu·∫•t: Ch·∫°y trang fix_admin.html l·∫°i.', 'info');
                }

            } catch (error) {
                log(`L·ªói k·∫øt n·ªëi: ${error.message}`, 'fail');
                log('G·ª£i √Ω: Ki·ªÉm tra Security Rules trong Firebase Console ho·∫∑c k·∫øt n·ªëi m·∫°ng.', 'info');
            }
        }

        window.onload = runDiagnostics;
    </script>
</body>

</html>